Perfect. I’ll audit the current `ManiaRiskAnalyzer` and supporting backend modules with a surgical focus on enhancements grounded in recent literature and data science best practices. This includes revising or optimizing risk logic, temporal modeling, feature modularity, and configuration extensibility—all while using only Apple HealthKit and PAT inputs currently available.

I'll also propose modular expansions (e.g., `HypomaniaVariabilityAnalyzer`, `SleepPhaseShiftDetector`) based on validated clinical findings from the reviewed PDFs, clearly scoped for rule-based logic that fits your existing infrastructure.

I'll return shortly with a backend-centric upgrade proposal built to shock the tech and medical worlds.


# Computational Models and Digital Biomarkers for Bipolar Disorder (Type I & II)

## Digital Phenotyping in Bipolar Disorder: Overview

Emerging **digital phenotyping** approaches leverage data from smartphones and wearables to monitor mood disorders. Research shows that passive signals like sleep patterns, activity levels, heart rate, and phone usage can help distinguish mood states and even predict impending episodes. For example, multiple studies have successfully used wearable-derived features (e.g. steps, sleep, heart rate) to classify individuals with depression vs. healthy controls using machine learning. More challenging – but highly valuable – is predicting mood swings in **bipolar disorder (BD)** in real time. Recent high-quality studies indicate that changes in daily behavior and physiology can foreshadow **manic/hypomanic** or **depressive episodes** days in advance, enabling early intervention. Below, we summarize state-of-the-art computational models and digital biomarkers for BD type I and II, focusing on solutions that work “out of the box” with wearable data and minimal custom training.

## Sleep and Circadian Rhythm Features for Episode Prediction

**Sleep disruptions and circadian rhythm shifts** are strongly linked to bipolar mood episodes. A 2024 study by Lim *et al.* (npj Digital Medicine) developed an accurate model using only sleep-wake patterns and prior episode history. They derived 36 features from patients’ longitudinal sleep data and achieved high prediction performance for next-day mood episodes – with AUCs of 0.80 for depression, 0.98 for mania, and 0.95 for hypomania. Notably, the most influential predictor was the **daily circadian phase shift** in sleep timing: **delays** in a person’s sleep-wake cycle foreshadowed depressive episodes, whereas **advances** (shifting to earlier wake times) signaled impending manic episodes. This finding aligns with clinical observations that bipolar depression often comes with oversleeping or phase delay, while mania is preceded by reduced need for sleep and early awakening. Importantly, this model is practical – it uses only sleep data passively collected via common devices (or smartphones) and each patient’s own history. The authors have made their trained **XGBoost** models and code publicly available on GitHub, so an implementation could potentially be plugged into a backend system without requiring new model training. In essence, tracking a patient’s sleep timing and applying this model (or even simple rules from its findings) can yield an out-of-the-box predictor for mood episodes.

## Activity Variability as an Early Indicator of Mood Swings

Beyond sleep, **day-to-day variability** in physical activity and sleep quality has emerged as a robust early-warning signal for mood shifts in BD. Ortiz *et al.* conducted *dense* longitudinal monitoring of bipolar patients using wearables and identified that increased variability in certain metrics precedes clinical transitions. In patients who eventually had hypomanic episodes, the **within-night variability in sleep stages** was the earliest red flag – it spiked in the days leading up to the onset of hypomania. In fact, these researchers developed a **time-frequency spike detection** algorithm to detect significant fluctuations in sleep/activity data; using this, they could detect the onset of hypomania **several days in advance** with high sensitivity (e.g. 94% sensitivity using 12-hour sleep variability windows). On the depression side, a companion study found that **variability in daily step count** was the earliest indicator of emerging bipolar depressive symptoms. Specifically, swings in activity levels anticipated depressive symptom onset by a median of \~7 days, which was a significantly longer lead time than changes in sleep provided (sleep changes gave \~4 days warning). In practical terms, these findings suggest that a rule-based monitoring approach can be effective: by continuously analyzing the *stability* of a person’s activity and sleep patterns (e.g. via a wearable fitness tracker or smart ring), sudden increases in variability can trigger alerts for possible upcoming mood episodes. Such an approach does **not** require large labeled datasets – it relies on each individual as their own baseline. The algorithmic method (looking for spikes in variability) can be distilled into backend logic to flag unusual deviations, enabling **individualized early interventions** for BD I or II patients.

## Personalized Machine Learning with Wearable Data

Machine learning models that personalize to each patient’s data have shown “out-of-the-box” promise for broad deployment. A notable example is the **Fitbit-based mood prediction model** by Lipschitz *et al.* (2024). In this study, 54 bipolar patients wore consumer Fitbit devices for 9 months, while reporting mood symptoms bi-weekly. The researchers trained a novel **Binary Mixed Model (BiMM) forest** algorithm on each person’s passive data (steps, sleep, etc.) aggregated in two-week windows. The result was **accurate detection of mood symptomatology** without any specialized sensors or intensive data cleaning. On a held-out test set, their model achieved ROC-AUCs of \~86% for detecting depression and \~85% for (hypo)mania episodes. Using an optimized threshold, this corresponded to \~80% sensitivity and 85–90% specificity – in other words, a high probability of correctly identifying episodes with few false alarms. Crucially, this performance was achieved with *only* off-the-shelf wearables and self-reported mood scales, indicating the method’s suitability for real-world use. The authors note that this personalized ML approach moves the field toward solutions that work for the **full population of patients**, not just those willing to use complex or invasive devices. For integration into a backend, a similar approach could be taken: use a patient’s own historical wearable data to train a lightweight predictive model (e.g. the BiMM forest or even simpler classifiers). Even if labeled mood data are sparse, transfer learning or pre-trained models from studies like this could be applied. The key advantage is that such models naturally account for individual baselines (e.g. one person’s “active day” might be another’s “sedentary”), making them robust without extensive additional training data.

## Multi-Sensor Data and Future Directions (Including Mixed States)

More advanced wearables and multimodal data sources are being explored to capture a fuller picture of bipolar mood dynamics – including **mixed episodes** and treatment responses. For instance, the ongoing **TIMEBASE** project is using a research-grade wearable (Empatica E4) to gather rich physiological signals in bipolar patients across different mood states. This study records metrics like accelerometry (activity), skin temperature, heart rate (via blood volume pulse), and electrodermal activity over 48-hour periods during acute mania, bipolar depression, and mixed-feature episodes, as well as during treatment and recovery phases. With 84 participants (including groups with BD I mania, bipolar depression, BD with mixed features, unipolar depression, and healthy controls), the goal is to identify **digital biomarkers** that signal illness activity and predict how patients respond to medications. Machine learning models will be trained on these physiological data to detect mood changes and **prodromal symptoms**, hopefully enabling even earlier and more personalized interventions. Although results are not yet published, TIMEBASE reflects a broader trend: leveraging **multi-sensor data** (beyond just sleep and steps) to understand bipolar disorder. In the near future, this could yield “batteries-included” algorithms for backends – for example, models that incorporate heart rate variability or skin conductance to detect heightened arousal in mania versus lethargy in depression. Notably, even without labeled outcomes, some of these signals can enrich rule-based systems (e.g. detecting abrupt increases in autonomic arousal could flag a mixed manic state). As research like this matures, we expect more open datasets and pre-trained models covering bipolar I, II, and mixed states.

## Implementation Considerations (No Labeled Data Scenarios)

When integrating these findings into a product backend **without proprietary data**, a few strategies emerge from the above research:

* **Use published models/weights:** Leverage models that researchers have made available. For example, Lim *et al.* provide their trained XGBoost models for mood episode prediction. These could potentially be applied to your users’ sleep data (after some calibration) to get immediate predictions of mania, hypomania, or depression risk. Since the model relies on generalizable features (sleep duration, timing, variability, etc.), it may work out-of-the-box or with minimal tuning on external data.
* **Distill into rules and thresholds:** The empirical patterns discovered – like circadian phase shifts and activity variability – can be coded as heuristic rules. This requires no training data. For instance, your backend can monitor a user’s **sleep midpoint** (the halfway point of their sleep period) over time; if it consistently shifts earlier by a certain threshold, trigger a mania risk alert, whereas a consistent delay triggers a depression alert. Likewise, compute a rolling window of day-to-day variability in steps or sleep quality; if variability jumps above a set percentile of that individual’s baseline, flag a possible impending episode. These threshold values can be informed by the literature (e.g. Ortiz *et al.* used a time-frequency spike detection to pinpoint significant deviations) or adjusted per user.
* **Personalization:** Wherever possible, personalize the analytics to each user. The success of the BiMM forest model and the focus on individual history in other studies suggest that modeling **within-subject changes** beats population-wide one-size-fits-all models. Even without labeled episodes, you can establish each person’s normal range for metrics like sleep length, bed/wake time, activity level, etc. Then detect anomalies relative to their own history – this inherently adapts to users with different lifestyles or bipolar subtypes (BD I vs BD II).
* **Open datasets and further tuning:** While obtaining large labeled bipolar datasets is challenging, you might incorporate public datasets or findings from related conditions. For example, large actigraphy datasets (like the UK Biobank’s 100k wearable records) can help refine algorithms for detecting circadian abnormalities. Additionally, many depression-focused digital phenotyping models exist (as depression is part of bipolar illness) – these could be repurposed or fine-tuned for bipolar use if needed. Always ensure any external model generalizes to bipolar populations (for instance, checking that it doesn’t miss manic states).

In summary, **computational approaches for bipolar I & II are rapidly advancing**, and there are several high-quality, ready-to-use solutions. Simple **wearable-derived metrics** like sleep timing shifts and activity variability have demonstrated remarkable predictive power for mood episodes. On the other end, more complex **personalized ML models** (e.g. tailored Fitbit data algorithms) have achieved \~85–90% accuracy in detecting mood changes in clinical studies. Many of these innovations can be distilled into actionable tools for your backend – either by deploying the released models/code or by implementing the core rules they uncover. By integrating these digital biomarkers, one can monitor bipolar patients continuously and potentially anticipate depressive, hypomanic, manic, or even mixed episodes before they fully manifest, enabling proactive care and stabilization.

**Sources:** High-quality research papers and protocols were referenced to compile these insights, including Lim *et al.* (2024), Ortiz *et al.* (2025), Lipschitz *et al.* (2024), and the TIMEBASE study protocol (Anmella *et al.*, 2024). These provide detailed evidence on digital methods for bipolar disorder monitoring and were used to ensure the recommendations here are grounded in reputable, peer-reviewed findings.
